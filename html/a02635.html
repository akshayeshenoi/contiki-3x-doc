<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Contiki 3.x: USB Contiki Task</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Contiki 3.x
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a02635.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">USB Contiki Task<div class="ingroups"><a class="el" href="a02648.html">Contiki platforms</a> &raquo; <a class="el" href="a02849.html">RZRAVEN USB Stick (Jackdaw)</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga7d453cb18055e3b9daa81e267336bc2d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7d453cb18055e3b9daa81e267336bc2d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga7d453cb18055e3b9daa81e267336bc2d">suspend_action</a> (void)</td></tr>
<tr class="memdesc:ga7d453cb18055e3b9daa81e267336bc2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Spare function to handle sleep mode. <br /></td></tr>
<tr class="separator:ga7d453cb18055e3b9daa81e267336bc2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3384a2b4d7c3cf2702b11ec8aaa39223"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga3384a2b4d7c3cf2702b11ec8aaa39223">usb_start_device</a> (void)</td></tr>
<tr class="memdesc:ga3384a2b4d7c3cf2702b11ec8aaa39223"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function initializes the USB device controller.  <a href="#ga3384a2b4d7c3cf2702b11ec8aaa39223">More...</a><br /></td></tr>
<tr class="separator:ga3384a2b4d7c3cf2702b11ec8aaa39223"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9da4d63b9eb1fe3fd750da71d118251f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga9da4d63b9eb1fe3fd750da71d118251f">pollhandler</a> (void)</td></tr>
<tr class="memdesc:ga9da4d63b9eb1fe3fd750da71d118251f"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB Poll Handler.  <a href="#ga9da4d63b9eb1fe3fd750da71d118251f">More...</a><br /></td></tr>
<tr class="separator:ga9da4d63b9eb1fe3fd750da71d118251f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85ebdddd1082b856cc32403149e97e57"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga85ebdddd1082b856cc32403149e97e57">PROCESS_THREAD</a> (usb_process, ev, data_proc)</td></tr>
<tr class="memdesc:ga85ebdddd1082b856cc32403149e97e57"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB Process.  <a href="#ga85ebdddd1082b856cc32403149e97e57">More...</a><br /></td></tr>
<tr class="separator:ga85ebdddd1082b856cc32403149e97e57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga28bf4c54d9527b4a20eb142b6cf3d66a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga28bf4c54d9527b4a20eb142b6cf3d66a">ISR</a> (USB_GEN_vect)</td></tr>
<tr class="memdesc:ga28bf4c54d9527b4a20eb142b6cf3d66a"><td class="mdescLeft">&#160;</td><td class="mdescRight">USB general interrupt subroutine.  <a href="#ga28bf4c54d9527b4a20eb142b6cf3d66a">More...</a><br /></td></tr>
<tr class="separator:ga28bf4c54d9527b4a20eb142b6cf3d66a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga6cf672ed8af4ff22afc70302f124a56b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga6cf672ed8af4ff22afc70302f124a56b"></a>
volatile uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga6cf672ed8af4ff22afc70302f124a56b">g_usb_event</a> =0</td></tr>
<tr class="memdesc:ga6cf672ed8af4ff22afc70302f124a56b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Public : U16 g_usb_event usb_connected is used to store USB events detected upon USB general interrupt subroutine Its value is managed by the following macros (See <a class="el" href="a01366.html" title="This file manages the USB task either device/host or both. ">usb_task.h</a> file) <a class="el" href="a02636.html#ga5a10a90b40c67b40f448c91d8a29abd5" title="Send event. ">Usb_send_event(x)</a> <a class="el" href="a02636.html#ga41da8b1e05449acf720091b1cab8cb3f" title="Ack event processed. ">Usb_ack_event(x)</a> <a class="el" href="a02636.html#gabd7e6a26ac11daf279b07563e3b6dc11" title="Clear all events. ">Usb_clear_all_event()</a> <a class="el" href="a02636.html#ga7c9320480ef6ad04fa7ecc5fbe46794d" title="Check for USB event. ">Is_usb_event(x)</a> <a class="el" href="a02636.html#ga3da7d8904c82c9c2e4e8cd9f1bdb54e0" title="Check for USB event NOT occuring. ">Is_not_usb_event(x)</a> <br /></td></tr>
<tr class="separator:ga6cf672ed8af4ff22afc70302f124a56b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga23b6941338ed6040e65fe3deb2bc3cf4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga23b6941338ed6040e65fe3deb2bc3cf4"></a>
bit&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga23b6941338ed6040e65fe3deb2bc3cf4">usb_connected</a></td></tr>
<tr class="memdesc:ga23b6941338ed6040e65fe3deb2bc3cf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Public : (bit) usb_connected usb_connected is set to TRUE when VBUS has been detected usb_connected is set to FALSE otherwise Used with USB_DEVICE_FEATURE == ENABLED only /. <br /></td></tr>
<tr class="separator:ga23b6941338ed6040e65fe3deb2bc3cf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga17e7aa663c771d6bddfea612365b55ee"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga17e7aa663c771d6bddfea612365b55ee"></a>
U8&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02635.html#ga17e7aa663c771d6bddfea612365b55ee">usb_configuration_nb</a></td></tr>
<tr class="memdesc:ga17e7aa663c771d6bddfea612365b55ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Public : (U8) usb_configuration_nb Store the number of the USB configuration used by the USB device when its value is different from zero, it means the device mode is enumerated Used with USB_DEVICE_FEATURE == ENABLED only /. <br /></td></tr>
<tr class="separator:ga17e7aa663c771d6bddfea612365b55ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<dl class="section author"><dt>Author</dt><dd>Colin O'Flynn <a href="#" onclick="location.href='mai'+'lto:'+'cof'+'ly'+'nn@'+'ne'+'wae'+'.c'+'om'; return false;">cofly<span style="display: none;">.nosp@m.</span>nn@n<span style="display: none;">.nosp@m.</span>ewae.<span style="display: none;">.nosp@m.</span>com</a></dd>
<dd>
Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br />
 Support email: <a href="#" onclick="location.href='mai'+'lto:'+'avr'+'@a'+'tme'+'l.'+'com'; return false;">avr@a<span style="display: none;">.nosp@m.</span>tmel<span style="display: none;">.nosp@m.</span>.com</a> </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga28bf4c54d9527b4a20eb142b6cf3d66a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ISR </td>
          <td>(</td>
          <td class="paramtype">USB_GEN_vect&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>USB general interrupt subroutine. </p>
<p>This function is called each time a USB interrupt occurs. The following USB DEVICE events are taken in charge:</p><ul>
<li>VBus On / Off</li>
<li>Start Of Frame</li>
<li>Suspend</li>
<li>Wake-Up</li>
<li>Resume</li>
<li>Reset</li>
<li>Start of frame</li>
</ul>
<p>For each event, the user can launch an action by completing the associate define (See <a class="el" href="a01334.html" title="This file contains the possible external configuration of the USB. ">conf_usb.h</a> file to add action upon events)</p>
<p>Note: Only interrupts events that are enabled are processed </p>

<p>Definition at line <a class="el" href="a01365_source.html#l00294">294</a> of file <a class="el" href="a01365_source.html">usb_task.c</a>.</p>

<p>References <a class="el" href="a01366_source.html#l00092">EVT_USB_POWERED</a>, <a class="el" href="a01366_source.html#l00106">EVT_USB_RESET</a>, <a class="el" href="a01366_source.html#l00104">EVT_USB_RESUME</a>, <a class="el" href="a01366_source.html#l00100">EVT_USB_SUSPEND</a>, <a class="el" href="a01366_source.html#l00094">EVT_USB_UNPOWERED</a>, <a class="el" href="a01366_source.html#l00102">EVT_USB_WAKE_UP</a>, <a class="el" href="a01872_source.html#l00180">FALSE</a>, <a class="el" href="a01360_source.html#l00418">Is_usb_reset</a>, <a class="el" href="a01360_source.html#l00398">Is_usb_resume</a>, <a class="el" href="a01360_source.html#l00428">Is_usb_sof</a>, <a class="el" href="a01360_source.html#l00438">Is_usb_suspend</a>, <a class="el" href="a01360_source.html#l00408">Is_usb_wake_up</a>, <a class="el" href="a01872_source.html#l00186">NULL</a>, <a class="el" href="a00963_source.html#l00322">process_post()</a>, <a class="el" href="a01872_source.html#l00175">TRUE</a>, <a class="el" href="a01360_source.html#l00416">Usb_ack_reset</a>, <a class="el" href="a01360_source.html#l00396">Usb_ack_resume</a>, <a class="el" href="a01360_source.html#l00426">Usb_ack_sof</a>, <a class="el" href="a01360_source.html#l00436">Usb_ack_suspend</a>, <a class="el" href="a01360_source.html#l00406">Usb_ack_wake_up</a>, <a class="el" href="a01360_source.html#l00369">Usb_attach</a>, <a class="el" href="a01363_source.html#l00093">usb_configuration_nb</a>, <a class="el" href="a01365_source.html#l00115">usb_connected</a>, <a class="el" href="a01360_source.html#l00393">Usb_disable_resume_interrupt</a>, <a class="el" href="a01360_source.html#l00403">Usb_disable_wake_up_interrupt</a>, <a class="el" href="a01360_source.html#l00411">Usb_enable_reset_interrupt</a>, <a class="el" href="a01360_source.html#l00401">Usb_enable_wake_up_interrupt</a>, <a class="el" href="a01360_source.html#l00228">Usb_freeze_clock</a>, <a class="el" href="a01359_source.html#l00303">usb_init_device()</a>, <a class="el" href="a01366_source.html#l00078">Usb_send_event</a>, and <a class="el" href="a01365_source.html#l00149">usb_start_device()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9da4d63b9eb1fe3fd750da71d118251f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void pollhandler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>USB Poll Handler. </p>
<p>This routine is repetively called, and deals with things such as new SETUP transfers on the control endpoint </p>
<dl><dt><b>Examples: </b></dt><dd><a class="el" href="a00008.html#a1">example-pollhandler.c</a>.</dd>
</dl>
<p>Definition at line <a class="el" href="a01365_source.html#l00167">167</a> of file <a class="el" href="a01365_source.html">usb_task.c</a>.</p>

<p>References <a class="el" href="a01360_source.html#l00552">Is_usb_receive_setup</a>, <a class="el" href="a01360_source.html#l00548">Is_usb_write_enabled</a>, <a class="el" href="a00963_source.html#l00371">process_poll()</a>, <a class="el" href="a01363_source.html#l00118">usb_process_request()</a>, <a class="el" href="a01360_source.html#l00460">Usb_select_endpoint</a>, <a class="el" href="a01360_source.html#l00558">Usb_send_in</a>, and <a class="el" href="a01360_source.html#l00598">Usb_write_byte</a>.</p>

<p>Referenced by <a class="el" href="a01365_source.html#l00217">PROCESS_THREAD()</a>.</p>

</div>
</div>
<a class="anchor" id="ga85ebdddd1082b856cc32403149e97e57"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PROCESS_THREAD </td>
          <td>(</td>
          <td class="paramtype">usb_process&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ev&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data_proc&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>USB Process. </p>
<p>The actual USB process, deals with USB events such as resets, and being plugged in or unplugged. A seperate polling routine is setup, which continously checks for things such as SETUP packets on the control interface. They must be responded to very quickly, hence the need for a polling process. </p>

<p>Definition at line <a class="el" href="a01365_source.html#l00217">217</a> of file <a class="el" href="a01365_source.html">usb_task.c</a>.</p>

<p>References <a class="el" href="a01366_source.html#l00106">EVT_USB_RESET</a>, <a class="el" href="a01872_source.html#l00180">FALSE</a>, <a class="el" href="a01366_source.html#l00084">Is_usb_event</a>, <a class="el" href="a01365_source.html#l00167">pollhandler()</a>, <a class="el" href="a00964_source.html#l00120">PROCESS_BEGIN</a>, <a class="el" href="a00964_source.html#l00131">PROCESS_END</a>, <a class="el" href="a00963_source.html#l00371">process_poll()</a>, <a class="el" href="a00964_source.html#l00242">PROCESS_POLLHANDLER</a>, <a class="el" href="a00964_source.html#l00157">PROCESS_WAIT_EVENT_UNTIL</a>, <a class="el" href="a01872_source.html#l00175">TRUE</a>, <a class="el" href="a01366_source.html#l00080">Usb_ack_event</a>, <a class="el" href="a01363_source.html#l00093">usb_configuration_nb</a>, <a class="el" href="a01365_source.html#l00115">usb_connected</a>, <a class="el" href="a01360_source.html#l00215">Usb_disable</a>, <a class="el" href="a01360_source.html#l00213">Usb_enable</a>, <a class="el" href="a01360_source.html#l00184">Usb_enable_regulator</a>, <a class="el" href="a01360_source.html#l00200">Usb_force_device_mode</a>, <a class="el" href="a01360_source.html#l00210">Usb_low_speed_mode</a>, <a class="el" href="a01360_source.html#l00466">Usb_reset_endpoint</a>, and <a class="el" href="a01365_source.html#l00149">usb_start_device()</a>.</p>

</div>
</div>
<a class="anchor" id="ga3384a2b4d7c3cf2702b11ec8aaa39223"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usb_start_device </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function initializes the USB device controller. </p>
<p>This function enables the USB controller and init the USB interrupts. The aim is to allow the USB connection detection in order to send the appropriate USB event to the operating mode manager. Start device function is executed once VBUS connection has been detected either by the VBUS change interrupt either by the VBUS high level </p>

<p>Definition at line <a class="el" href="a01365_source.html#l00149">149</a> of file <a class="el" href="a01365_source.html">usb_task.c</a>.</p>

<p>References <a class="el" href="a01360_source.html#l00369">Usb_attach</a>, <a class="el" href="a01360_source.html#l00411">Usb_enable_reset_interrupt</a>, <a class="el" href="a01359_source.html#l00303">usb_init_device()</a>, and <a class="el" href="a01335_source.html#l00087">Wait_pll_ready</a>.</p>

<p>Referenced by <a class="el" href="a01365_source.html#l00294">ISR()</a>, and <a class="el" href="a01365_source.html#l00217">PROCESS_THREAD()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Mar 11 2022 12:06:08 for Contiki 3.x by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
