<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Contiki 3.x: Architecture support for multi-threading</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Contiki 3.x
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a02580.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Architecture support for multi-threading<div class="ingroups"><a class="el" href="a02853.html">Contiki system</a> &raquo; <a class="el" href="a02579.html">Multi-threading library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The Contiki multi-threading library requires some architecture specific support for setting up and switching stacks.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:a00960"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00960.html">mt.h</a></td></tr>
<tr class="memdesc:a00960"><td class="mdescLeft">&#160;</td><td class="mdescRight">Header file for the preemptive multitasking library for Contiki. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae6c3647c7d74d742d7af00bfb8b439eb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02580.html#gae6c3647c7d74d742d7af00bfb8b439eb">mtarch_init</a> (void)</td></tr>
<tr class="memdesc:gae6c3647c7d74d742d7af00bfb8b439eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the architecture specific support functions for the multi-thread library.  <a href="#gae6c3647c7d74d742d7af00bfb8b439eb">More...</a><br /></td></tr>
<tr class="separator:gae6c3647c7d74d742d7af00bfb8b439eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga55f67d4d317753c821c07d1ff5914288"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga55f67d4d317753c821c07d1ff5914288"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02580.html#ga55f67d4d317753c821c07d1ff5914288">mtarch_remove</a> (void)</td></tr>
<tr class="memdesc:ga55f67d4d317753c821c07d1ff5914288"><td class="mdescLeft">&#160;</td><td class="mdescRight">Uninstall library and clean up. <br /></td></tr>
<tr class="separator:ga55f67d4d317753c821c07d1ff5914288"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9802b3e4ee64b9744c202fe5c908e0e0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02580.html#ga9802b3e4ee64b9744c202fe5c908e0e0">mtarch_start</a> (struct <a class="el" href="a00110.html">mtarch_thread</a> *thread, void(*function)(void *data), void *data)</td></tr>
<tr class="memdesc:ga9802b3e4ee64b9744c202fe5c908e0e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the stack frame for a thread that is being started.  <a href="#ga9802b3e4ee64b9744c202fe5c908e0e0">More...</a><br /></td></tr>
<tr class="separator:ga9802b3e4ee64b9744c202fe5c908e0e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa8dae45595dba936ab58b7d303450dc4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02580.html#gaa8dae45595dba936ab58b7d303450dc4">mtarch_exec</a> (struct <a class="el" href="a00110.html">mtarch_thread</a> *thread)</td></tr>
<tr class="memdesc:gaa8dae45595dba936ab58b7d303450dc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start executing a thread.  <a href="#gaa8dae45595dba936ab58b7d303450dc4">More...</a><br /></td></tr>
<tr class="separator:gaa8dae45595dba936ab58b7d303450dc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9fdf472144bb2412c912df15cae85e06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02580.html#ga9fdf472144bb2412c912df15cae85e06">mtarch_yield</a> (void)</td></tr>
<tr class="memdesc:ga9fdf472144bb2412c912df15cae85e06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Yield the processor.  <a href="#ga9fdf472144bb2412c912df15cae85e06">More...</a><br /></td></tr>
<tr class="separator:ga9fdf472144bb2412c912df15cae85e06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3703ee485e2a20e0501f7018bd9ddb1b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a02580.html#ga3703ee485e2a20e0501f7018bd9ddb1b">mtarch_stop</a> (struct <a class="el" href="a00110.html">mtarch_thread</a> *thread)</td></tr>
<tr class="memdesc:ga3703ee485e2a20e0501f7018bd9ddb1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up the stack of a thread.  <a href="#ga3703ee485e2a20e0501f7018bd9ddb1b">More...</a><br /></td></tr>
<tr class="separator:ga3703ee485e2a20e0501f7018bd9ddb1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The Contiki multi-threading library requires some architecture specific support for setting up and switching stacks. </p>
<p>This support requires four stack manipulation functions to be implemented: <a class="el" href="a02580.html#ga9802b3e4ee64b9744c202fe5c908e0e0" title="Setup the stack frame for a thread that is being started. ">mtarch_start()</a>, which sets up the stack frame for a new thread, <a class="el" href="a02580.html#gaa8dae45595dba936ab58b7d303450dc4" title="Start executing a thread. ">mtarch_exec()</a>, which switches in the stack of a thread, <a class="el" href="a02580.html#ga9fdf472144bb2412c912df15cae85e06" title="Yield the processor. ">mtarch_yield()</a>, which restores the kernel stack from a thread's stack and <a class="el" href="a02580.html#ga3703ee485e2a20e0501f7018bd9ddb1b" title="Clean up the stack of a thread. ">mtarch_stop()</a>, which cleans up the stack of a thread. Additionally, two functions for controlling the preemption (if any) must be implemented: mtarch_pstart() and mtarch_pstop(). If no preemption is used, these functions can be implemented as empty functions. Finally, the function <a class="el" href="a02580.html#gae6c3647c7d74d742d7af00bfb8b439eb" title="Initialize the architecture specific support functions for the multi-thread library. ">mtarch_init()</a> is called by <a class="el" href="a02579.html#ga9b7e54b6a727e74f998736238a6ba424" title="Initializes the multithreading library. ">mt_init()</a>, and can be used for initialization of timer interrupts, or any other mechanisms required for correct operation of the architecture specific support functions while <a class="el" href="a02580.html#ga55f67d4d317753c821c07d1ff5914288" title="Uninstall library and clean up. ">mtarch_remove()</a> is called by <a class="el" href="a02579.html#gad4b502d5e08885704143bffe3d4565d6" title="Uninstalls library and cleans up. ">mt_remove()</a> to clean up those resources. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaa8dae45595dba936ab58b7d303450dc4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mtarch_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00110.html">mtarch_thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start executing a thread. </p>
<p>This function is called from <a class="el" href="a02579.html#ga2ceaab27edea6cebcdc92cbc3d412e1d" title="Execute parts of a thread. ">mt_exec()</a> and the purpose of the function is to start execution of the thread. The function should switch in the stack of the thread, and does not return until the thread has explicitly yielded (using <a class="el" href="a02579.html#ga821508e238ebc521234018e469afe636" title="Voluntarily give up the processor. ">mt_yield()</a>) or until it is preempted.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>A pointer to a struct <a class="el" href="a00110.html" title="Copyright (c) 2014, Analog Devices, Inc. ">mtarch_thread</a> for the thread to be executed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a01035_source.html#l00095">95</a> of file <a class="el" href="a01035_source.html">mtarch.c</a>.</p>

<p>References <a class="el" href="a01846_source.html#l00194">__attribute__</a>, and <a class="el" href="a01872_source.html#l00186">NULL</a>.</p>

<p>Referenced by <a class="el" href="a00959_source.html#l00075">mt_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="gae6c3647c7d74d742d7af00bfb8b439eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mtarch_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the architecture specific support functions for the multi-thread library. </p>
<p>This function is implemented by the architecture specific functions for the multi-thread library and is called by the <a class="el" href="a02579.html#ga9b7e54b6a727e74f998736238a6ba424" title="Initializes the multithreading library. ">mt_init()</a> function as part of the initialization of the library. The <a class="el" href="a02580.html#gae6c3647c7d74d742d7af00bfb8b439eb" title="Initialize the architecture specific support functions for the multi-thread library. ">mtarch_init()</a> function can be used for, e.g., starting preemption timers or other architecture specific mechanisms required for the operation of the library. </p>

<p>Definition at line <a class="el" href="a01035_source.html#l00049">49</a> of file <a class="el" href="a01035_source.html">mtarch.c</a>.</p>

<p>References <a class="el" href="a01211_source.html#l00355">__DSB</a>, <a class="el" href="a01211_source.html#l00344">__ISB</a>, <a class="el" href="a01080_source.html#l00135">__NVIC_PRIO_BITS</a>, <a class="el" href="a00959_source.html#l00097">mt_exit()</a>, <a class="el" href="a01044_source.html#l00064">MTARCH_STACKSIZE</a>, <a class="el" href="a01035_source.html#l00059">mtarch_start()</a>, <a class="el" href="a01872_source.html#l00186">NULL</a>, <a class="el" href="a01215_source.html#l00701">NVIC_SetPriority()</a>, <a class="el" href="a01080_source.html#l00079">PendSV_IRQn</a>, <a class="el" href="a01215_source.html#l00587">SCB</a>, <a class="el" href="a01217_source.html#l00550">SCB_CCR_NONBASETHRDENA_Msk</a>, <a class="el" href="a01215_source.html#l00474">SCB_CCR_STKALIGN_Msk</a>, and <a class="el" href="a01080_source.html#l00077">SVCall_IRQn</a>.</p>

<p>Referenced by <a class="el" href="a00959_source.html#l00053">mt_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9802b3e4ee64b9744c202fe5c908e0e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mtarch_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00110.html">mtarch_thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void *data)&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup the stack frame for a thread that is being started. </p>
<p>This function is called by the <a class="el" href="a02579.html#ga7eb58b7ea94b3c1b86494a43ef95fb9d" title="Starts a multithreading thread. ">mt_start()</a> function in order to set up the architecture specific stack of the thread to be started.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>A pointer to a struct <a class="el" href="a00110.html" title="Copyright (c) 2014, Analog Devices, Inc. ">mtarch_thread</a> for the thread to be started.</td></tr>
    <tr><td class="paramname">function</td><td>A pointer to the function that the thread will start executing the first time it is scheduled to run.</td></tr>
    <tr><td class="paramname">data</td><td>A pointer to the argument that the function should be passed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a01035_source.html#l00059">59</a> of file <a class="el" href="a01035_source.html">mtarch.c</a>.</p>

<p>References <a class="el" href="a00758_source.html#l00501">context</a>, <a class="el" href="a00959_source.html#l00097">mt_exit()</a>, <a class="el" href="a01872_source.html#l00186">NULL</a>, and <a class="el" href="a01215_source.html#l00325">xPSR_T_Msk</a>.</p>

<p>Referenced by <a class="el" href="a00959_source.html#l00065">mt_start()</a>, and <a class="el" href="a01037_source.html#l00046">mtarch_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ga3703ee485e2a20e0501f7018bd9ddb1b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mtarch_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="a00110.html">mtarch_thread</a> *&#160;</td>
          <td class="paramname"><em>thread</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clean up the stack of a thread. </p>
<p>This function is called by the <a class="el" href="a02579.html#ga56186be13a78313ac222a9a11cef92b4" title="Stop a thread. ">mt_stop()</a> function in order to clean up the architecture specific stack of the thread to be stopped.</p>
<dl class="section note"><dt>Note</dt><dd>If the stack is wholly contained in struct <a class="el" href="a00110.html" title="Copyright (c) 2014, Analog Devices, Inc. ">mtarch_thread</a> this function may very well be empty.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">thread</td><td>A pointer to a struct <a class="el" href="a00110.html" title="Copyright (c) 2014, Analog Devices, Inc. ">mtarch_thread</a> for the thread to be stopped. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="a01035_source.html#l00110">110</a> of file <a class="el" href="a01035_source.html">mtarch.c</a>.</p>

<p>References <a class="el" href="a01044_source.html#l00064">MTARCH_STACKSIZE</a>, <a class="el" href="a01215_source.html#l00587">SCB</a>, and <a class="el" href="a01215_source.html#l00423">SCB_ICSR_PENDSVSET_Msk</a>.</p>

<p>Referenced by <a class="el" href="a00959_source.html#l00105">mt_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9fdf472144bb2412c912df15cae85e06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mtarch_yield </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Yield the processor. </p>
<p>This function is called by the <a class="el" href="a02579.html#ga821508e238ebc521234018e469afe636" title="Voluntarily give up the processor. ">mt_yield()</a> function, which is called from the running thread in order to give up the processor. </p>

<p>Definition at line <a class="el" href="a01035_source.html#l00089">89</a> of file <a class="el" href="a01035_source.html">mtarch.c</a>.</p>

<p>Referenced by <a class="el" href="a00959_source.html#l00097">mt_exit()</a>, and <a class="el" href="a00959_source.html#l00086">mt_yield()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Mar 11 2022 12:06:08 for Contiki 3.x by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
